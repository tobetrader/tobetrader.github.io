!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).depthchart={})}(this,(function(t){"use strict";function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function n(t,e){for(var i=0;e.length>i;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function o(t,e,i){return e&&n(t.prototype,e),i&&n(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&r(t,e)}function a(t){return(a=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function r(t,e){return(r=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function h(t,e){if(e&&("object"==typeof e||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function l(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=a(t);if(e){var o=a(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return h(this,i)}}function c(t){return(window.devicePixelRatio||1)/(t.backingStorePixelRatio||t.webkitBackingStorePixelRatio||t.mozBackingStorePixelRatio||t.msBackingStorePixelRatio||t.oBackingStorePixelRatio||t.backingStorePixelRatio||1)}function u(t,e){return Math.ceil(t.measureText(e).width)}function _(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Arial";return"".concat(t,"px ").concat(e)}var d=function(){function t(e,n,o,s){i(this,t),this._container=e,this._chartModel=n,this._xAxis=o,this._yAxis=s,this._initCanvas(e)}return o(t,[{key:"_initCanvas",value:function(t){this._canvas=document.createElement("canvas"),this._canvas.style.position="absolute",this._canvas.style.top="0",this._canvas.style.left="0",this._canvas.style.zIndex="1",this._ctx=this._canvas.getContext("2d"),t.appendChild(this._canvas),this.layout(t.offsetWidth,t.offsetHeight)}},{key:"_redraw",value:function(t){this._ctx.clearRect(0,0,this._width,this._height),t&&t(),this._draw()}},{key:"_draw",value:function(){}},{key:"layout",value:function(){var t=this;this._redraw((function(){var e=c(t._ctx);t._width=t._container.offsetWidth,t._height=t._container.offsetHeight,t._canvas.style.top="0",t._canvas.style.width="".concat(t._width,"px"),t._canvas.style.height="".concat(t._height,"px"),t._canvas.width=t._width*e,t._canvas.height=t._height*e,t._ctx.scale(e,e)}))}},{key:"update",value:function(){var t,e,i=this;this.requestAnimationId&&(t=this.requestAnimationId,window.cancelAnimationFrame||clearTimeout(t),window.cancelAnimationFrame(t)),this.requestAnimationId=(e=function(){i._redraw()},window.requestAnimationFrame?window.requestAnimationFrame(e):window.setTimeout((function(){e()}),1e3/60))}}]),t}();function v(t,e,i,n){t.beginPath();var o=t.lineWidth%2?.5:0;t.moveTo(i,e+o),t.lineTo(n,e+o),t.stroke(),t.closePath()}function x(t,e,i,n){t.beginPath();var o=t.lineWidth%2?.5:0;t.moveTo(e+o,i),t.lineTo(e+o,n),t.stroke(),t.closePath()}var f=function(t){s(n,t);var e=l(n);function n(){return i(this,n),e.apply(this,arguments)}return o(n,[{key:"_draw",value:function(){var t=this._chartModel.options(),e=this._chartModel.viewport();this._drawMiddleLine(e,t.middle),this._drawBidArea(e,t.bid),this._drawAskArea(e,t.ask),this._drawXAxis(e,t.xAxis),this._drawYAxis(e,t.yAxis)}},{key:"_drawMiddleLine",value:function(t,e){var i=this._chartModel.dataSet().middle;if(i){var n=this._xAxis.convertToPixel(i.index);this._ctx.lineWidth=e.line.size,this._ctx.strokeStyle=e.line.color,x(this._ctx,n,t.top(),t.bottom())}}},{key:"_drawXAxis",value:function(t,e){this._drawXAxisLine(t,e),this._drawXAxisTick(t,e)}},{key:"_drawXAxisLine",value:function(t,e){var i=e.axisLine;this._ctx.lineWidth=i.size,this._ctx.strokeStyle=i.color,v(this._ctx,t.bottom(),t.left(),t.right())}},{key:"_drawXAxisTick",value:function(t,e){var i=this,n=e.tickLine,o=e.tickText,s=this._xAxis.ticks(),a=t.bottom(),r=a+n.length,h=r+o.margin;this._ctx.save(),this._ctx.lineWidth=n.size,this._ctx.font=_(o.size,o.family),this._ctx.textAlign="center",this._ctx.textBaseline="top",s.forEach((function(t){i._ctx.strokeStyle=n.color,x(i._ctx,t.x,a,r),i._ctx.fillStyle=o.color,i._ctx.fillText("".concat(t.v),t.x,h)})),this._ctx.restore()}},{key:"_drawYAxis",value:function(t,e){this._drawYAxisLine(t,e),this._drawYAxisTick(t,e)}},{key:"_drawYAxisLine",value:function(t,e){var i=e.axisLine;this._ctx.lineWidth=i.size,this._ctx.strokeStyle=i.color,x(this._ctx,t.right(),t.top(),t.bottom())}},{key:"_drawYAxisTick",value:function(t,e){var i=this,n=e.tickLine,o=e.tickText,s=this._yAxis.ticks(),a=t.right(),r=a+n.length,h=r+o.margin;this._ctx.save(),this._ctx.lineWidth=n.size,this._ctx.font=_(o.size,o.family),this._ctx.textBaseline="middle",this._ctx.strokeStyle=n.color,this._ctx.fillStyle=o.color,s.forEach((function(t){v(i._ctx,t.y,a,r),i._ctx.fillText("".concat(t.v),h,t.y)})),this._ctx.restore()}},{key:"_drawBidArea",value:function(t,e){var i=this,n=this._chartModel.dataSet().bids,o=void 0===n?[]:n;if(o.length>0){var s=this._chartModel.singleDataSpace();this._ctx.fillStyle=e.areaColor,this._ctx.beginPath(),this._ctx.moveTo(t.left(),t.bottom());var a=t.left(),r=this._yAxis.convertToPixel(o[0].volume),h=[{x:a,y:r}];this._ctx.lineTo(a,r),o.forEach((function(t,e){var n=t.volume,o=i._xAxis.convertToPixel(e),s=i._yAxis.convertToPixel(n);h.push({x:o,y:s}),i._ctx.lineTo(o,s)}));var l=h[h.length-1];this._ctx.lineTo(l.x+s/2,l.y),h.push({x:l.x+s/2,y:l.y}),this._ctx.lineTo(l.x+s/2,t.bottom()),h.push({x:l.x+s/2,y:t.bottom()}),this._ctx.fill(),this._ctx.closePath(),this._drawAreaStrokeLine(h,e)}}},{key:"_drawAskArea",value:function(t,e){var i=this,n=this._chartModel.dataSet(),o=n.asks,s=void 0===o?[]:o,a=n.middle,r=void 0===a?{index:0}:a;if(s.length>0){var h=this._chartModel.singleDataSpace(),l=this._chartModel.hasMiddle()?r.index:-1;this._ctx.fillStyle=e.areaColor,this._ctx.beginPath();var c=this._xAxis.convertToPixel(l+1),u=this._yAxis.convertToPixel(s[0].volume),_=[{x:c-h/2,y:t.bottom()},{x:c-h/2,y:u}];this._ctx.moveTo(_[0].x,_[0].y),this._ctx.lineTo(_[1].x,_[1].y),s.forEach((function(t,e){var n=t.volume,o=i._xAxis.convertToPixel(e+l+1),s=i._yAxis.convertToPixel(n);_.push({x:o,y:s}),i._ctx.lineTo(o,s)}));var d=_[_.length-1];_.push({x:t.right(),y:d.y}),this._ctx.lineTo(_[_.length-1].x,_[_.length-1].y),this._ctx.lineTo(_[_.length-1].x,t.bottom()),this._ctx.fill(),this._ctx.closePath(),this._drawAreaStrokeLine(_,e)}}},{key:"_drawAreaStrokeLine",value:function(t,e){var i,n,o=this;this._ctx.lineWidth=e.lineSize,this._ctx.strokeStyle=e.lineColor,n=function(){o._ctx.beginPath(),o._ctx.moveTo(t[0].x,t[0].y);for(var e=0;t.length>e;e++)o._ctx.lineTo(t[e].x,t[e].y);o._ctx.stroke(),o._ctx.closePath()},(i=this._ctx).save(),i.lineWidth%2&&i.translate(.5,.5),n(),i.restore()}}]),n}(d);function p(t,e,i,n,o){t.fillStyle=o,t.beginPath(),t.arc(e,i,n,0,2*Math.PI),t.closePath(),t.fill()}function m(t,e,i,n,o,s){t.beginPath(),t.moveTo(e+s,i),t.arcTo(e+n,i,e+n,i+o,s),t.arcTo(e+n,i+o,e,i+o,s),t.arcTo(e,i+o,e,i,s),t.arcTo(e,i,e+n,i,s),t.closePath()}function y(t,e){if(b(t)&&b(e))for(var i in e)if(t.hasOwnProperty(i)){var n=t[i],o=e[i];b(o)&&b(n)&&!k(o)&&!k(n)?y(n,o):(e[i]||0===e[i]||!1===e[i])&&(t[i]=e[i])}}function g(t){if(!t||!b(t))return t;var e,i,n;for(i in e=k(t)?[]:{},t)t.hasOwnProperty(i)&&(e[i]=(n=t[i])&&b(n)?g(n):n);return e}function k(t){return"[object Array]"===Object.prototype.toString.call(t)}function b(t){var i=e(t);return"function"===i||!!t&&"object"===i}function T(t){return"number"==typeof t}function M(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"--";if(t&&b(t)){var n=t[e];if(n||0===n||!1===n)return n}return i}function w(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,i=+t;return(i||0===i)&&T(i)?i.toFixed(e):"".concat(i)}function P(t){return T(+t)?1e9>t?1e6>t?1e3>t?t:"".concat((t/1e3).toFixed(3),"K"):"".concat((t/1e6).toFixed(3),"M"):"".concat((t/1e9).toFixed(3),"B"):"--"}var E=function(t){s(n,t);var e=l(n);function n(){return i(this,n),e.apply(this,arguments)}return o(n,[{key:"_draw",value:function(){var t=this._chartModel.tooltipPoint();if(t){var e=this._xAxis.convertFromPixel(t.x),i=this._chartModel.getRealTooltipData(e);if(i){var n=this._chartModel.pricePrecision(),o=this._chartModel.volumePrecision(),s=this._chartModel.viewport(),a=i.bid,r=i.ask,h=this._chartModel.options().tooltip,l=h.cross.outerCircle.radius,c=this._chartModel.dataSet(),d=c.bids,f=c.asks,y=this._xAxis.convertToPixel(c.middle.index);if(a.data){var g=this._xAxis.convertToPixel(a.xIndex),k=this._yAxis.convertToPixel(a.data.volume);this._ctx.fillStyle="rgba(255, 255, 255, 0.05)",this._ctx.fillRect(s.left(),s.top(),g-s.left(),s.bottom()-s.top()),p(this._ctx,g,k,l,h.cross.outerCircle.bidColor),p(this._ctx,g,k,h.cross.innerCircle.radius,h.cross.innerCircle.bidColor),this._ctx.save(),this._ctx.lineWidth=h.line.size,this._ctx.strokeStyle=h.line.bidColor,"dash"===h.line.style&&this._ctx.setLineDash(h.line.dashValue),v(this._ctx,k,s.left(),y),x(this._ctx,g,s.top(),s.bottom()),this._ctx.restore(),this._ctx.save(),this._ctx.fillStyle=h.text.bidColor,this._ctx.font=_(h.text.size,h.text.family),this._ctx.textBaseline="top",this._ctx.textAlign="center",this._ctx.fillText(w(a.data.price,n),g,s.bottom()+6),this._ctx.textBaseline="middle",this._ctx.textAlign="left",this._ctx.fillText(P(w(a.data.volume,o)),s.left()+2,k);var b=d[d.length-1];if(b){var T="".concat(w((b.price-a.data.price)/b.price*100,2),"%"),M=u(this._ctx,T),E=Math.round((y+g)/2),C=M+h.text.paddingLeft+h.text.paddingRight,A=h.text.size+h.text.paddingTop+h.text.paddingBottom;this._ctx.textAlign="center",this._ctx.fillStyle=h.text.backgroundColor,m(this._ctx,Math.round(E-C/2),Math.round(k-A/2),C,A,2),this._ctx.fill(),this._ctx.fillStyle=h.text.bidColor,this._ctx.fillText(T,E,k)}this._ctx.restore()}if(r.data){var S=this._xAxis.convertToPixel(r.xIndex),L=this._yAxis.convertToPixel(r.data.volume);this._ctx.fillStyle="rgba(255, 255, 255, 0.05)",this._ctx.fillRect(S,s.top(),s.right()-S,s.bottom()-s.top()),p(this._ctx,S,L,l,h.cross.outerCircle.askColor),p(this._ctx,S,L,h.cross.innerCircle.radius,h.cross.innerCircle.askColor),this._ctx.save(),this._ctx.lineWidth=h.line.size,this._ctx.strokeStyle=h.line.askColor,"dash"===h.line.style&&this._ctx.setLineDash(h.line.dashValue),v(this._ctx,L,y,s.right()),x(this._ctx,S,s.top(),s.bottom()),this._ctx.restore(),this._ctx.save(),this._ctx.fillStyle=h.text.askColor,this._ctx.font=_(h.text.size,h.text.family),this._ctx.textBaseline="top",this._ctx.textAlign="center",this._ctx.fillText(w(r.data.price,n),S,s.bottom()+6),this._ctx.textBaseline="middle",this._ctx.textAlign="left",this._ctx.fillText(P(w(r.data.volume,o)),s.right()+6,L);var D=f[0];if(D){var z="".concat(w((r.data.price-D.price)/D.price*100,2),"%"),H=u(this._ctx,z),V=Math.round((y+S)/2),R=H+h.text.paddingLeft+h.text.paddingRight,O=h.text.size+h.text.paddingTop+h.text.paddingBottom;this._ctx.textAlign="center",this._ctx.fillStyle=h.text.backgroundColor,m(this._ctx,Math.round(V-R/2),Math.round(L-O/2),R,O,2),this._ctx.fill(),this._ctx.fillStyle=h.text.askColor,this._ctx.fillText(z,V,L)}this._ctx.restore()}}}}}]),n}(d),C=function(){function t(e){i(this,t),this._chartModel=e,this._minValue=0,this._maxValue=0,this._range=0,this._ticks=[],this._initMeasureCanvas()}return o(t,[{key:"_initMeasureCanvas",value:function(){var t=document.createElement("canvas");this._measureCtx=t.getContext("2d");var e=c(this._measureCtx);this._measureCtx.scale(e,e)}},{key:"computeAxis",value:function(){var t=this._tickSpan();this._ticks=this._optimalTick(t)}},{key:"_tickSpan",value:function(){return this._ticks}},{key:"_optimalTick",value:function(){}},{key:"_nice",value:function(t){var e=Math.floor(Math.log(t)/Math.LN10),i=Math.pow(10,e),n=t/i;return t=(1.5>n?1:2.5>n?2:3.5>n?3:4.5>n?4:5.5>n?5:6.5>n?6:8)*i,-20>e?t:+t.toFixed(0>e?-e:0)}},{key:"_getIntervalPrecision",value:function(t){var e=""+t,i=e.indexOf("e");if(i>0){var n=+e.slice(i+1);return 0>n?-n:0}var o=e.indexOf(".");return 0>o?0:e.length-1-o}},{key:"ticks",value:function(){return this._ticks}}]),t}(),A=function(t){s(n,t);var e=l(n);function n(){return i(this,n),e.apply(this,arguments)}return o(n,[{key:"calcMaxMin",value:function(){}},{key:"_tickSpan",value:function(){var t=this._chartModel.dataSet(),e=t.bids,i=void 0===e?[]:e,n=t.asks,o=void 0===n?[]:n,s=+this._nice(Math.max(i.length,o.length)/5),a=[],r=this._chartModel.pricePrecision();if(i.length>0)for(var h=i.length-s-1;h>0;h-=s){var l=i[h];l&&a.unshift({index:Math.floor(h),v:w(l.price,r)})}var c=[];if(o.length>0)for(var u=s-1;o.length>u;u+=s){var _=o[u];_&&c.push({index:Math.ceil(u),v:w(_.price,r)})}return{bidTicks:a,askTicks:c}}},{key:"_optimalTick",value:function(t){var e=this._chartModel.dataSet().middle,i=t.bidTicks,n=t.askTicks,o=[],s=[],a=(s=i.length>n.length?i:n).length;if(a>0){var r=this._chartModel.viewport(),h=this._chartModel.options().xAxis.tickText;this._measureCtx.font=_(h.size,h.family);var l=u(this._measureCtx,"".concat(s[0].v)),c=2*l,d=this.convertToPixel(+s[0].index),v=1;if(a>1){var x=this.convertToPixel(+s[1].index),f=Math.abs(x-d);c>f&&(v=Math.ceil(c/f))}for(var p=i.length-v;p>=0;p-=v){var m=this.convertToPixel(i[p].index);m-l/2<r.left()||m+l/2>r.right()||o.unshift({x:m,v:i[p].v})}if(this._chartModel.hasMiddle()){var y=this.convertToPixel(e.index);y-l/2<r.left()||y+l/2>r.right()||o.push({x:this.convertToPixel(e.index),v:e.price})}for(var g=this._chartModel.hasMiddle()?e.index+1:e.index,k=v-1;n.length>k;k+=v){var b=this.convertToPixel(g+n[k].index);b-l/2<r.left()||b+l/2>r.right()||o.push({x:b,v:n[k].v})}}return o}},{key:"getSelfHeight",value:function(){var t=this._chartModel.options().xAxis;return t.axisLine.size+t.tickLine.length+t.tickText.size+2*t.tickText.margin}},{key:"convertFromPixel",value:function(t){var e=this._chartModel.singleDataSpace(),i=this._chartModel.viewport();return Math.round((t-i.left()-e/2)/e)}},{key:"convertToPixel",value:function(t){var e=this._chartModel.singleDataSpace(),i=this._chartModel.viewport();return Math.round(i.left()+t*e+e/2)}}]),n}(C),S=function(t){s(n,t);var e=l(n);function n(){return i(this,n),e.apply(this,arguments)}return o(n,[{key:"calcMaxMin",value:function(){var t=this._chartModel.dataSet(),e=t.bids,i=void 0===e?[]:e,n=t.asks,o=void 0===n?[]:n;this._minValue=0;var s=Math.max(M(i[0],"volume",0),M(o[o.length-1],"volume",0));0===s&&(s=10),this._maxValue=s+Math.round(.05*(s-this._minValue)),this._range=this._maxValue-this._minValue}},{key:"_tickSpan",value:function(){var t=[],e=+this._nice(this._range/5),i=this._getIntervalPrecision(e),n=+this._round(Math.ceil(this._minValue/e)*e,i),o=+this._round(Math.floor(this._maxValue/e)*e,i),s=0,a=n;if(0!==e)for(;o>=a;)t[s]={v:a.toFixed(i)},++s,a+=e;return t}},{key:"_optimalTick",value:function(t){var e=[],i=t.length;if(i>0){var n=this._chartModel.viewport(),o=this._chartModel.options().xAxis.tickText.size,s=2*o,a=this.convertToPixel(+t[0].v),r=1;if(i>1){var h=this.convertToPixel(+t[1].v),l=Math.abs(h-a);s>l&&(r=Math.ceil(s/l))}for(var c=this._chartModel.volumePrecision(),u=0;i>u;u+=r){var _=this.convertToPixel(+t[u].v);if(_-o/2>=n.top()){var d=w(t[u].v,c);e.push({y:_,v:0==+d?"0":P(d)})}}}return e}},{key:"_round",value:function(t,e){return null==e&&(e=10),t=(+t).toFixed(e=Math.min(Math.max(0,e),20))}},{key:"getSelfWidth",value:function(){var t=this,e=this._chartModel.options().yAxis;this._measureCtx.font=_(e.tickText.size,e.tickText.family);var i=0;return this.ticks().forEach((function(e){i=Math.max(u(t._measureCtx,e.v),i)})),e.axisLine.size+e.tickLine.length+i+2*e.tickText.margin}},{key:"convertFromPixel",value:function(t){return t/this._chartModel.viewport().contentHeight()*(this._maxValue-this._minValue)+this._minValue}},{key:"convertToPixel",value:function(t){var e=this._chartModel.viewport();return e.top()+Math.round((1-(t-this._minValue)/(this._maxValue-this._minValue))*e.contentHeight())}}]),n}(C),L=function(){function t(){i(this,t),this._width=0,this._height=0,this._left=0,this._right=0,this._top=0,this._bottom=0}return o(t,[{key:"setViewport",value:function(t,e,i,n,o,s){this._width=t,this._height=e,this._left=i,this._right=n,this._top=o,this._bottom=s}},{key:"width",value:function(){return this._width}},{key:"height",value:function(){return this._height}},{key:"contentHeight",value:function(){return this._bottom-this._top}},{key:"contentWidth",value:function(){return this._right-this._left}},{key:"left",value:function(){return this._left}},{key:"right",value:function(){return this._right}},{key:"top",value:function(){return this._top}},{key:"bottom",value:function(){return this._bottom}}]),t}(),D={axisLine:{color:"#242838",size:1},tickLine:{size:1,length:3,color:"#727684"},tickText:{color:"#727684",size:12,family:"Arial",margin:3}},z={grid:{left:0,top:0,right:0,bottom:0},middle:{line:{size:1,color:"#242838"}},xAxis:D,yAxis:D,bid:{areaColor:"rgba(64, 205, 110, 0.08)",lineColor:"#40CD6E",lineSize:2},ask:{areaColor:"rgba(234, 76, 97, 0.08)",lineColor:"#EA4C61",lineSize:2},tooltip:{cross:{innerCircle:{radius:5,bidColor:"#40CD6E",askColor:"#EA4C61"},outerCircle:{radius:10,bidColor:"rgba(64, 205, 110, 0.2)",askColor:"rgba(234, 76, 97, 0.2)"}},text:{size:12,family:"Arial",bidColor:"#40CD6E",askColor:"#EA4C61",backgroundColor:"rgba(0, 0, 0, .3)",paddingTop:4,paddingBottom:4,paddingLeft:6,paddingRight:6},line:{size:1,style:"dash",dashValue:[1,2],bidColor:"#40CD6E",askColor:"#EA4C61"}}},H="bid",V="ask",R=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1?arguments[1]:void 0;i(this,t),this._updateTooltipHandler=n,this._dataSet={},this._options=g(z),y(this._options,e),this._viewport=new L,this._singleDataSpace=0,this._pricePrecision=2,this._volumePrecision=4,this._tooltipPoint=null}return o(t,[{key:"setOptions",value:function(t){y(this._options,t)}},{key:"options",value:function(){return this._options}},{key:"viewport",value:function(){return this._viewport}},{key:"setDataSet",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.bids,i=void 0===e?[]:e,n=t.asks,o=void 0===n?[]:n,s=M(i[i.length-1],"price",0),a=M(o[0],"price",s),r=w((+s+ +a)/2,this._pricePrecision),h=i.length+o.length;i.length>0&&o.length>0&&(h+=1),this._singleDataSpace=this._viewport.contentWidth()/(h||1),this._dataSet={middle:{price:r,index:i.length},bids:i,asks:o,totalDataSize:h}}},{key:"dataSet",value:function(){return this._dataSet}},{key:"hasMiddle",value:function(){var t=this._dataSet,e=t.bids,i=t.asks;return(void 0===e?[]:e).length>0&&(void 0===i?[]:i).length>0}},{key:"setTooltipPoint",value:function(t){this._tooltipPoint=t,this._updateTooltipHandler()}},{key:"tooltipPoint",value:function(){return this._tooltipPoint}},{key:"setPricePrecision",value:function(t){T(t)&&t>=0&&(this._pricePrecision=parseInt(t,10))}},{key:"pricePrecision",value:function(){return this._pricePrecision}},{key:"setVolumePrecision",value:function(t){T(t)&&t>=0&&(this._volumePrecision=parseInt(t,10))}},{key:"setViewport",value:function(t,e,i,n,o,s){this._viewport.setViewport(t,e,i,n,o,s);var a=this._dataSet.totalDataSize,r=void 0===a?1:a;this._singleDataSpace=this._viewport.contentWidth()/(r||1)}},{key:"volumePrecision",value:function(){return this._volumePrecision}},{key:"singleDataSpace",value:function(){return this._singleDataSpace}},{key:"getRealTooltipData",value:function(t){var e=this._dataSet,i=e.bids,n=void 0===i?[]:i,o=e.asks,s=void 0===o?[]:o,a=e.totalDataSize;if((void 0===a?0:a)>t&&t>=0){if(t>n.length-1){var r=this.hasMiddle()?t-n.length-1:t,h=s[r];if(h)return{type:V,bid:{data:n[n.length+n.length-t],index:n.length+n.length-t,xIndex:n.length+n.length-t},ask:{data:h,index:r,xIndex:t}}}var l=n[t];if(l)return{type:H,bid:{data:l,index:t,xIndex:t},ask:{data:s[s.length-1-t],index:s.length-1-t,xIndex:n.length+s.length-t}}}return null}}]),t}(),O=0,I=2;function W(t){return!!t.touches}function B(t){t.cancelable&&t.preventDefault()}function X(){var t=!!navigator.maxTouchPoints||!!navigator.msMaxTouchPoints||"ontouchstart"in window||!!(window.DocumentTouch&&document instanceof window.DocumentTouch);return"onorientationchange"in window&&t}var Y="mouse",j="touch",F=function(){function t(e,n,o){i(this,t),this._target=e,this._handler=n,this._options=o,this._clickCount=0,this._clickTimeoutId=null,this._longTapTimeoutId=null,this._mouseMoveStartPosition=null,this._moveExceededManhattanDistance=!1,this._cancelClick=!1,this._unsubscribeOutsideEvents=null,this._unsubscribeMousemove=null,this._unsubscribeRoot=null,this._startPinchMiddlePoint=null,this._preventDragProcess=!1,this._mousePressed=!1,this._init()}return o(t,[{key:"destroy",value:function(){null!==this._unsubscribeOutsideEvents&&(this._unsubscribeOutsideEvents(),this._unsubscribeOutsideEvents=null),null!==this._unsubscribeMousemove&&(this._unsubscribeMousemove(),this._unsubscribeMousemove=null),null!==this._unsubscribeRoot&&(this._unsubscribeRoot(),this._unsubscribeRoot=null),this._clearLongTapTimeout(),this._resetClickTimeout()}},{key:"_mouseEnterHandler",value:function(t){var e=this;this._unsubscribeMousemove&&this._unsubscribeMousemove();var i=this._mouseMoveHandler.bind(this);this._unsubscribeMousemove=function(){e._target.removeEventListener("mousemove",i)},this._target.addEventListener("mousemove",i),W(t)&&this._mouseMoveHandler(t);var n=this._makeCompatEvent(t);this._processEvent(n,this._handler.mouseEnterEvent)}},{key:"_resetClickTimeout",value:function(){null!==this._clickTimeoutId&&clearTimeout(this._clickTimeoutId),this._clickCount=0,this._clickTimeoutId=null}},{key:"_mouseMoveHandler",value:function(t){if(!this._mousePressed||W(t)){var e=this._makeCompatEvent(t);this._processEvent(e,this._handler.mouseMoveEvent)}}},{key:"_mouseMoveWithDownHandler",value:function(t){if((!("button"in t)||t.button===O)&&null===this._startPinchMiddlePoint){var e=W(t);if(!this._preventDragProcess||!e){var i=this._makeCompatEvent(t),n=this._mouseMoveStartPosition,o=Math.abs(n.x-i.pageX),s=Math.abs(n.y-i.pageY),a=o+s>5;if(a||!e){if(a&&!this._moveExceededManhattanDistance&&e){var r=.5*o;s>=r&&!this._options.treatVertTouchDragAsPageScroll||r>s&&!this._options.treatHorzTouchDragAsPageScroll||(this._preventDragProcess=!0)}a&&(this._moveExceededManhattanDistance=!0,this._cancelClick=!0,e&&this._clearLongTapTimeout()),this._preventDragProcess||(this._processEvent(i,this._handler.pressedMouseMoveEvent),e&&B(t))}}}}},{key:"_mouseUpHandler",value:function(t){if(!("button"in t)||t.button===O){var e=this._makeCompatEvent(t);this._clearLongTapTimeout(),this._mouseMoveStartPosition=null,this._mousePressed=!1,this._unsubscribeRoot&&(this._unsubscribeRoot(),this._unsubscribeRoot=null),W(t)&&this._mouseLeaveHandler(t),this._processEvent(e,this._handler.mouseUpEvent),++this._clickCount,this._clickTimeoutId&&this._clickCount>1?(this._processEvent(e,this._handler.mouseDoubleClickEvent),this._resetClickTimeout()):this._cancelClick||this._processEvent(e,this._handler.mouseClickEvent),W(t)&&(B(t),this._mouseLeaveHandler(t))}}},{key:"_clearLongTapTimeout",value:function(){null!==this._longTapTimeoutId&&(clearTimeout(this._longTapTimeoutId),this._longTapTimeoutId=null)}},{key:"_mouseDownHandler",value:function(t){if(!("button"in t)||t.button===O||t.button===I){var e=this._makeCompatEvent(t);if(!("button"in t)||t.button!==I){this._cancelClick=!1,this._moveExceededManhattanDistance=!1,this._preventDragProcess=!1,W(t)&&this._mouseEnterHandler(t),this._mouseMoveStartPosition={x:e.pageX,y:e.pageY},this._unsubscribeRoot&&(this._unsubscribeRoot(),this._unsubscribeRoot=null);var i=this._mouseMoveWithDownHandler.bind(this),n=this._mouseUpHandler.bind(this),o=this._target.ownerDocument.documentElement;this._unsubscribeRoot=function(){o.removeEventListener("touchmove",i),o.removeEventListener("touchend",n),o.removeEventListener("mousemove",i),o.removeEventListener("mouseup",n)},o.addEventListener("touchmove",i,{passive:!1}),o.addEventListener("touchend",n,{passive:!1}),this._clearLongTapTimeout(),W(t)&&1===t.touches.length?this._longTapTimeoutId=setTimeout(this._longTapHandler.bind(this,t),600):(o.addEventListener("mousemove",i),o.addEventListener("mouseup",n)),this._mousePressed=!0,this._processEvent(e,this._handler.mouseDownEvent),this._clickTimeoutId||(this._clickCount=0,this._clickTimeoutId=setTimeout(this._resetClickTimeout.bind(this),500))}}}},{key:"_init",value:function(){var t=this;this._target.addEventListener("mouseenter",this._mouseEnterHandler.bind(this)),this._target.addEventListener("touchcancel",this._clearLongTapTimeout.bind(this));var e=this._target.ownerDocument,i=function(e){t._handler.mouseDownOutsideEvent&&(e.target&&t._target.contains(e.target)||t._handler.mouseDownOutsideEvent())};this._unsubscribeOutsideEvents=function(){e.removeEventListener("mousedown",i),e.removeEventListener("touchstart",i)},e.addEventListener("mousedown",i),e.addEventListener("touchstart",i,{passive:!0}),this._target.addEventListener("mouseleave",this._mouseLeaveHandler.bind(this)),this._target.addEventListener("touchstart",this._mouseDownHandler.bind(this),{passive:!0}),X()||this._target.addEventListener("mousedown",this._mouseDownHandler.bind(this)),this._target.addEventListener("touchmove",(function(){}),{passive:!1})}},{key:"_mouseLeaveHandler",value:function(t){this._unsubscribeMousemove&&this._unsubscribeMousemove();var e=this._makeCompatEvent(t);this._processEvent(e,this._handler.mouseLeaveEvent)}},{key:"_longTapHandler",value:function(t){var e=this._makeCompatEvent(t);this._processEvent(e,this._handler.longTapEvent),this._cancelClick=!0}},{key:"_processEvent",value:function(t,e){e&&e.call(this._handler,t)}},{key:"_makeCompatEvent",value:function(t){var e;e="touches"in t&&t.touches.length?t.touches[0]:"changedTouches"in t&&t.changedTouches.length?t.changedTouches[0]:t;var i=this._target.getBoundingClientRect()||{left:0,top:0};return{clientX:e.clientX,clientY:e.clientY,pageX:e.pageX,pageY:e.pageY,screenX:e.screenX,screenY:e.screenY,localX:e.clientX-i.left,localY:e.clientY-i.top,ctrlKey:t.ctrlKey,altKey:t.altKey,shiftKey:t.shiftKey,metaKey:t.metaKey,type:t.type.startsWith("mouse")?Y:j,target:e.target,view:t.view}}}]),t}(),K=function(){function t(e,n){i(this,t),this._chartModel=n,this._event=new F(e,{mouseClickEvent:this._mouseClickEvent.bind(this),mouseLeaveEvent:this._mouseLeaveEvent.bind(this),mouseMoveEvent:this._mouseMoveEvent.bind(this),pressedMouseMoveEvent:this._pressedMouseMoveEvent.bind(this),longTapEvent:this._longTapEvent.bind(this)},{treatVertTouchDragAsPageScroll:!1,treatHorzTouchDragAsPageScroll:!1})}return o(t,[{key:"_mouseMoveEvent",value:function(t){t.type===Y&&this._processEvent(t)}},{key:"_mouseClickEvent",value:function(t){t.type===j&&this._chartModel.setTooltipPoint(null)}},{key:"_pressedMouseMoveEvent",value:function(t){this._processEvent(t)}},{key:"_mouseLeaveEvent",value:function(t){t.type===Y&&this._chartModel.setTooltipPoint(null)}},{key:"_longTapEvent",value:function(t){t.type===j&&this._processEvent(t)}},{key:"_processEvent",value:function(t){var e=this._chartModel.viewport();t.localX<e.left()||t.localX>e.right()||t.localY<e.top()||t.localY>e.bottom()?this._chartModel.setTooltipPoint(null):this._chartModel.setTooltipPoint({x:t.localX,y:t.localY})}}]),t}();t.DepthChart=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};i(this,t),this._initContainer(e),this._chartModel=new R(n,this._updateTooltipHandler.bind(this)),this._xAxis=new A(this._chartModel),this._yAxis=new S(this._chartModel),this._areaView=new f(e,this._chartModel,this._xAxis,this._yAxis),this._tooltipView=new E(e,this._chartModel,this._xAxis,this._yAxis),this._chartEvent=new K(e,this._chartModel)}return o(t,[{key:"_initContainer",value:function(t){t.style.userSelect="none",t.style.webkitUserSelect="none",t.style.msUserSelect="none",t.style.MozUserSelect="none",t.style.webkitTapHighlightColor="transparent",t.style.position="relative",this._container=t}},{key:"_measure",value:function(){var t=this._container.offsetWidth,e=this._container.offsetHeight,i=this._chartModel.options().grid,n=Math.max(0,i.left),o=Math.max(0,i.right),s=Math.max(0,i.top),a=Math.max(0,i.bottom),r=this._xAxis.getSelfHeight(),h=this._yAxis.getSelfWidth();this._chartModel.setViewport(t,e,n,Math.max(t-h-o,0),s,Math.max(e-r-a,0)),this._xAxis.computeAxis(),this._yAxis.computeAxis()}},{key:"_updateTooltipHandler",value:function(){this._tooltipView.update()}},{key:"resize",value:function(){this._measure(),this._areaView.layout(),this._tooltipView.layout()}},{key:"applyOptions",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this._chartModel.setOptions(t),this.resize()}},{key:"setPricePrecision",value:function(t){this._chartModel.setPricePrecision(t)}},{key:"setVolumePrecision",value:function(t){this._chartModel.setVolumePrecision(t)}},{key:"applyData",value:function(t){this._chartModel.setDataSet(t),this._xAxis.calcMaxMin(),this._yAxis.calcMaxMin(),this._measure(),this._areaView.update(),this._tooltipView.update()}}]),t}(),Object.defineProperty(t,"__esModule",{value:!0})}));
